{% extends 'quality_base.html' %}

{% block title %}
    Trims Audit
{% endblock title %}


{% block content %}
    <div id="auditTable" name="auditTable">
        <form method="post" id="auditForm" autocomplete="off">
            {% csrf_token %}         <!--This is to protect against CSRF attacks-->
            <div class="row mt-1" row="0">
                <div class="col">
                    <div class="row {{theme.justify}} {{theme.textJustify}} {{theme.border}}">
                        <div class="col-12">
                            <input class="{{theme.textInput}}" readonly
                            value="Supplier: {{audit.supplier}}, Receipt: {{audit.ReceiptNumber}}">
                        </div>
                        <div class="col-12">
                            <div class="row">
                                <div class="col-8">
                                    <input class="{{theme.textInput}} bg-dark text-white" readonly
                                    value="{{audit.Inventory}} {% if audit.Variant %} ({{audit.Variant}}) {% endif %}">
                                </div>
                                <div class="col-4 btn-group {{theme.textJustify}}">
                                    <button type="submit" class="{{theme.buttonBasic}}">Save</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <input class="{{theme.textInput}}" readonly
                                value="Total Qty: {{audit.Quantity}}, Audit Qty: {{audit.AuditQuantity}}">
                        </div>
                        <div class="col mt-1 {{theme.justify}} {{theme.textJustify}}">  
                            <div class="row mt-1 {{theme.justify}} {{theme.textJustify}} bg-dark text-white" row="1">
                                <div class="col-4">
                                    <div class="{{theme.textJustify}} {{theme.border}}">
                                        Check List
                                    </div> 
                                </div>
                                <div class="col-3">
                                    <div class="{{theme.textJustify}} {{theme.border}}">
                                        Approval
                                    </div>  
                                </div>
                                <div class="col-3">
                                    <div class="{{theme.textJustify}} {{theme.border}}">
                                        Comemnts
                                    </div>  
                                </div>
                                <div class="col-2">
                                    <div class="{{theme.textJustify}} {{theme.border}}">
                                        Actions
                                    </div>  
                                </div>
                            </div>       
                            {% for auditData in audit.audit %}
                            <div class="row mt-1 {{theme.justify}} {{theme.textJustify}}" row="{{forloop.counter}}">
                                <div class="col-4" chosen="true">
                                    <select class="{{theme.dropdown}}" id="id_CheckList_{{forloop.counter}}" name="CheckList" required>
                                        {% for option in checkListOptions %}
                                            <option value="{{option.value}}" {% if option.value ==  auditData.CheckList%} selected {% endif %}> 
                                                {{option.text}}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-3">
                                    <select class="{{theme.dropdown}}" name="Approval" required>
                                        <option value="true" {% if auditData.Approval %} selected {% endif %}>
                                            Approved
                                        </option>
                                        <option value="false" {% if not auditData.Approval %} selected {% endif %}>
                                            Rejected
                                        </option>
                                    </select>
                                </div>
                                <div class="col-3">
                                    <input type="number" value="{{auditData.id}}" name="id" hidden="true">
                                    <input type="text" class="{{theme.textInput}}" value="{{auditData.Comments}}" name="Comments">
                                </div>
                                <div class="col-2">
                                    <button class="{{theme.plusButton}}" type="button" onclick="addRow(this)">
                                        <span>+</span>
                                    </button>
                                    <button class="{{theme.minusButton}}" type="button" onclick="removeRow(this)">
                                        <span>-</span>
                                    </button> 
                                </div>
                            </div>
                            {% endfor %}
                        </div>      
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>    //This code runs when the page is fully loaded.
        window.addEventListener('load', async () => {
            showLoadingIcon(200);

            //Apply search on dropdown where needed
            await addSearchBox();

            showErrorMessage();

            hideLoadingIcon();
        });

    </script>

    <script>    //To show error message to user
        function showErrorMessage() {
            const errorMessage = '{{error}}';
            if (errorMessage) {
                showMessage(errorMessage);
            } 
        }
    </script>
{% endblock content %}