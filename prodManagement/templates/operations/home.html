{% extends 'prodManagement/base.html' %}

{% block title %}
    Operations Bank
{% endblock title %}

{% block content %}
    <div class="{{theme.border}}">
        <form action="{% url 'operations' %}" method="get" autocomplete="off">
            <div class="grid grid-cols-10 {{theme.justify}} {{theme.align}}">
                <div class="flex flex-col col-[1/3] items-center">
                    <span class="text-sm text-gray-500 mb-1">Search:</span>
                    <input class="{{theme.textInput}}" name="search" value="{{search}}" placeholder="">
                </div>
                <div class="flex flex-col col-[3/5] items-center">
                    <span class="text-sm text-gray-500 mb-1">Section:</span>
                    <select name="sectionFilter" class="{{theme.dropdown}}" id="section" onchange="this.form.submit()"></select>
                </div>
                <div class="flex flex-col col-[5/6] items-center">
                    <span class="text-sm text-gray-500 mb-1">Skill Level:</span>
                    <select name="skillLevel" class="{{theme.dropdown}}" id="skillLevel" onchange="this.form.submit()">
                        <option value="null">All</option>
                        {% for i in "1234" %}
                            <option value="{{ i }}" {% if skillLevel == i %} selected {% endif %}
                                >{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex flex-col col-[6/8] items-center">
                    <span class="text-sm text-gray-500 mb-1">Machine Type:</span>
                    <select name="machineType" class="{{theme.dropdown}}" id="machineType" onchange="this.form.submit()"></select>
                </div>
                <div class="flex flex-col col-[8/9] items-center">
                    <span class="text-sm text-gray-500 mb-1">Min Rate/SAM:</span>
                    <input type="number" min="0" class="{{theme.textInput}}" name="ratePerSAM" value="{{ratePerSAM}}" placeholder="">
                </div>
                <div class="flex col-[9/11] btn-group {{theme.align}} justify-end ml-1">
                    <button type="submit" class="{{theme.buttonBasic}}">Search</button>
                    <a class="{{theme.buttonBasic}}" href="{% url 'addOperation' %}" role="button">Add</a>
                </div>
            </div>
        </form>
    </div>

    <div id="operationTable" class="mt-6">
        <table class="{{theme.table}}">
            <tr class = "{{theme.tableHead}}">
                <th scope="col">Code</th>
                <th scope="col">Name</th>
                <th scope="col">Section</th>
                <th scope="col">Category</th>
                <th scope="col">Level</th>
                <th scope="col">Type</th>
                <th scope="col">SAM</th>
                <th scope="col">Rate</th>
            </tr>
            <tbody id="tableData" class = "{{theme.tableBody}}">
                {% for data in operations%}
                <tr class="{{theme.tableBodyRow}}">
                    <td class="{{theme.hyperLink}}"> <a href="{% url 'editOperation' pk=data.id %}">{{ data.id }}</a></td>
                    <td>{{ data.Name }}</td>
                    <td>{{ data.Section }}</td>
                    <td>{{ data.Category }}</td>
                    <td>{{ data.SkillLevel }}</td>
                    <td>{{ data.MachineType }}</td>
                    <td>{{ data.SMV }}</td>
                    <td>{{ data.Rate }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="{{ theme.pagination }}">
        <div class="btn-group">
            {% if page_obj.has_previous %}
                <a href="?page=1&search={{search}}&sectionFilter={{sectionFilter}}&skillLevel={{skillLevel}}&machineType={{machineType}}&ratePerSAM={{ratePerSAM}}" class="btn btn-sm">First</a>
                <a href="?page={{ page_obj.previous_page_number }}&search={{search}}&sectionFilter={{sectionFilter}}&skillLevel={{skillLevel}}&machineType={{machineType}}&ratePerSAM={{ratePerSAM}}" class="btn btn-sm">Previous</a>
            {% else %}
                <button class="btn btn-sm" disabled>First</button>
                <button class="btn btn-sm" disabled>Previous</button>
            {% endif %}
    
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}&search={{search}}&sectionFilter={{sectionFilter}}&skillLevel={{skillLevel}}&machineType={{machineType}}&ratePerSAM={{ratePerSAM}}" class="btn btn-sm">Next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}&search={{search}}&sectionFilter={{sectionFilter}}&skillLevel={{skillLevel}}&machineType={{machineType}}&ratePerSAM={{ratePerSAM}}" class="btn btn-sm">Last</a>
            {% else %}
                <button class="btn btn-sm" disabled>Next</button>
                <button class="btn btn-sm" disabled>Last</button>
            {% endif %}
        </div>
    </div>

    <script> //To run when the page loads
        window.addEventListener('load', async () => {
            showLoadingIcon();

            let response = await fetch('/options/operations/sections');
            const sections = await response.json();
            await appendOptions('section', sections, '{{sectionFilter}}');

            response = await fetch('/options/machines/types');
            const machineTypes = await response.json();
            await appendOptions('machineType', machineTypes, '{{machineType}}');

            hideLoadingIcon();
        });
    </script>
{% endblock content %}