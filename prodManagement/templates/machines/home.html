{% extends 'prodManagement/base.html' %}

{% block title %}
    Machines
{% endblock title %}

{% block content %}
    <div class="{{theme.border}}">
        <form action="{% url 'machines' %}" method="get" autocomplete="off">
            <div class="grid grid-cols-12 {{theme.justify}} {{theme.align}}">
                <div class="flex flex-col col-[1/3] items-center">
                    <span class="text-sm text-gray-500 mb-1">Search:</span>
                    <input class="{{theme.textInput}}" name="search" value="{{search}}" placeholder="">
                </div>
                <div class="flex flex-col col-[3/5] items-center">
                    <span class="text-sm text-gray-500 mb-1">Type:</span>
                    <select name="type" class="{{theme.dropdown}}" id="type" onchange="this.form.submit()"></select>
                </div>
                <div class="flex flex-col col-[5/7] items-center">
                    <span class="text-sm text-gray-500 mb-1">Working?</span>
                    <select name="status" class="{{theme.dropdown}}" id="status" onchange="this.form.submit()">
                        <option value="null" {% if status == None %} selected {% endif %}>--------</option>
                        <option value="Yes" {% if status == 'Yes' %} selected {% endif %}>Yes</option>
                        <option value="No" {% if status == 'No' %} selected {% endif %}>No</option>
                        <option value="Sold" {% if status == 'Sold' %} selected {% endif %}>Sold</option>
                        <option value="Dead" {% if status == 'Dead' %} selected {% endif %}>Dead</option>
                    </select>
                </div>
                <div class="flex flex-col col-[7/9] items-center">
                    <span class="text-sm text-gray-500 mb-1">Manufacturer:</span>
                    <select name="manufacturer" class="{{theme.dropdown}}" id="manufacturer" onchange="this.form.submit()"></select>
                </div>
                <div class="flex flex-col col-[9/11] items-center">
                    <span class="text-sm text-gray-500 mb-1">Department:</span>
                    <select name="department" class="{{theme.dropdown}}" id="department" onchange="this.form.submit()">
                    </select>
                </div>
                <div class="flex col-[11/13] btn-group {{theme.align}} justify-end ml-1">
                    <button type="submit" class="{{theme.buttonBasic}}">Search</button>
                    <a class="{{theme.buttonBasic}}" href="{% url 'addMachine' %}" role="button">Add</a>
                </div>
            </div>
        </form>
    </div>

    <div id="operationTable" class="mt-6">
        <table class="{{theme.table}}">
            <tr class = "{{theme.tableHead}}">
                <th scope="col">Number</th>
                <th scope="col">Id</th>
                <th scope="col">Type</th>
                <th scope="col">Functioning?</th>
                <th scope="col">Manufacturer</th>
                <th scope="col">Model</th>
                <th scope="col">Serial</th>
                <th scope="col">Department</th>
            </tr>
            <tbody id="tableData" class = "{{theme.tableBody}}">
                {% for data in machines %}
                <tr class="{{theme.tableBodyRow}}">
                    <td class="{{theme.hyperLink}}"><a href="{% url 'editMachine' pk=data.id %}">{{ data.id }}</a></td>
                    <td>{{ data.MachineId }}</td>
                    <td>{{ data.Type }}</td>
                    <td>{{ data.FunctionStatus }}</td>
                    <td>{{ data.Manufacturer }}</td>
                    <td>{{ data.ModelNumber }}</td>
                    <td>{{ data.SerialNumber }}</td>
                    <td>{{ data.Department }}</td>
                </tr>
                {% endfor %}    
            </tbody>
        </table>
    </div>

    <script> //To run when the page loads
        window.addEventListener('load', async () => {
            showLoadingIcon();

            let response = await fetch('/options/machines/types');
            const machineTypes = await response.json();
            await appendOptions('type', machineTypes, '{{type}}');

            response = await fetch('/options/machines/manufacturers');
            const machineManufacturers = await response.json();
            await appendOptions('manufacturer', machineManufacturers, '{{manufacturer}}');

            response = await fetch('/options/departments');
            const departments = await response.json();
            await appendOptions('department', departments, '{{department}}');

            hideLoadingIcon();
        });
    </script>
{% endblock content %}