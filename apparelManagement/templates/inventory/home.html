{% extends 'base.html' %}

{% block title %}
    Inventory Cards
{% endblock %}

{% block content %}
  <div class="{{ theme.border }} p-4">
    <!-- Filters Section -->
    <div class="row g-3 {{ theme.justify }} {{ theme.align }}">
      <div class="col-6">
        <form action="{% url 'Inv' %}" method="get" class="flex gap-4">
          <div class="w-full {{ theme.textJustify }}">
            <label for="groupFilter" class="label">
              <span class="label-text">Group Filter</span>
            <select name="groupFilter" onchange="this.form.submit()" class="{{ theme.dropdown }} w-full">
              <option value="">  ---------  </option>
              {% for data in groups %}
                <option value="{{ data }}" {% if data == selectedGroup %} selected {% endif %}>
                  {{ data }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="w-full {{ theme.textJustify }}">
            <label for="stockFilter" class="label">
              <span class="label-text">Stock Filter</span>
            <select name="stockFilter" onchange="this.form.submit()" class="{{ theme.dropdown }} w-full">
              <option value="ALL" {% if stockFilter == 'ALL' %} selected {% endif %}>  All  </option>
              <option value="InStock" {% if stockFilter == 'InStock' %} selected {% endif %}>  In Stock  </option>
              <option value="Free" {% if stockFilter == 'Free' %} selected {% endif %}>  Free Stock  </option>
            </select>
          </div>
          <input type="hidden" name="search_term" value="{{ searchTerm }}">
        </form>
      </div>
      <div class="col btn-group {{ theme.textJustify }}">
        <a class="{{ theme.buttonSecondary }}" href="/inv/add" role="button" target="_blank">Add Card</a>
        <a id="copyCardButton" class="{{ theme.buttonSecondary }}" role="button" target="_blank">Copy Card</a>
        <a id="editCardButton" class="{{ theme.buttonSecondary }}" role="button" target="_blank">Edit Card</a>
        <a id="deleteCardButton" class="{{ theme.buttonSecondary }}" role="button">Delete Card</a>
      </div>
    </div>

    <!-- Search Section -->
    <div class="row g-0 {{ theme.justify }} {{ theme.align }} mt-6">
      <div class="col-md-10 {{ theme.textJustify }}">
        <form action="{% url 'Inv' %}" method="get" class="flex gap-4">
          <input type="text" class="{{ theme.textInput }} w-full" name="search_term" placeholder="Search inventory" value="{{ searchTerm }}">
          <input type="hidden" name="groupFilter" value="{{ selectedGroup }}">
          <input type="hidden" name="stockFilter" value="{{ stockFilter }}">
      </div>
      <div class="col-md-2 {{ theme.textJustify }}">
          <button type="submit" class="{{ theme.buttonBasic }} w-full">
            Search
          </button>
        </form> 
      </div>
    </div>

    <!-- Inventory Table -->
    <div id="inv_Table" class="mt-6">
      <table class="{{ theme.table }}">
        <thead>
          <tr class="{{ theme.tableHead }}">
            <th scope="col">Select</th>
            <th scope="col">Inventory Code</th>
            <th scope="col">Inventory Name</th>
            <th scope="col">Group</th>
            <th scope="col">Unit</th>
            <th scope="col">In Use?</th>  
            <th scope="col">Stock Level</th> 
            <th scope="col">Free Stock</th>      
          </tr>
        </thead>
        <tbody id="tableData" class="{{ theme.tableBody }}">
          {% for data in inv %}
            <tr>
              <td><input type="radio" name="item_checkbox" class="{{ theme.checkbox }}"></td>
              <td class="code">{{ data.Code }}</td>
              <td>{{ data.Name }}</td>
              <td>{{ data.Group }}</td>
              <td>{{ data.Unit }}</td>
              <td>{% if data.InUse %}Yes{% elif data.InUse == '' %}{% else %}No{% endif %}</td>
              <td>{{ data.StockLevel }}</td>
              <td>{{ data.FreeStock }}</td>
            </tr>     
          {% endfor %}    
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="{{ theme.pagination }}">
      <div class="flex space-x-4">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}&groupFilter={{ selectedGroup }}&search_term={{ searchTerm }}" class="{{ theme.buttonBasic }}">
            Previous
          </a>
        {% endif %}

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}&groupFilter={{ selectedGroup }}&search_term={{ searchTerm }}" class="{{ theme.buttonBasic }}">
            Next
          </a>
        {% endif %}
      </div>

      <div class="flex items-center space-x-2 mx-4">
        || &nbsp;
        {% if page_obj.has_previous %}
          <a href="?page=1&groupFilter={{ selectedGroup }}&search_term={{ searchTerm }}" class="{{ theme.buttonBasic }}">
            First
          </a>
        {% endif %}

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.paginator.num_pages }}&groupFilter={{ selectedGroup }}&search_term={{ searchTerm }}" class="{{ theme.buttonBasic }}">
            Last
          </a>
        {% endif %}
      </div>

      <form action="" method="get" class="ml-4">
        <select name="page" onchange="this.form.submit()" class="{{ theme.dropdown }} w-32">
          {% for page_num in page_obj.paginator.page_range %}
            <option value="{{ page_num }}" {% if page_num == page_obj.number %} selected {% endif %}>
              {{ page_num }}
            </option>
          {% endfor %}
        </select>
        <input type="hidden" name="groupFilter" value="{{ selectedGroup }}">
        <input type="hidden" name="search_term" value="{{ searchTerm }}">
      </form>
    </div>
  </div>


  <script>
    // Update button links based on selected item
    $("#tableData").on("click", "input[type='radio']", function() { 
      const selectedCode = $(this).closest("tr").find("td.code").text();
      $("#copyCardButton").attr("href", "/inv/" + selectedCode + "/copy");
      $("#editCardButton").attr("href", "/inv/" + selectedCode + "/edit");
      $("#deleteCardButton").attr("href", "/inv/" + selectedCode + "/delete");
    });          
  </script>
{% endblock %}